<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>戦略整理パートナー</title>
    <!-- Tailwind CSS (Utility First CSS) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome (Icons) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #F3F4F6; /* 薄いグレー */
            color: #374151; /* 濃いグレー */
        }
        
        /* カスタムラジオボタン・チェックボックスのスタイル */
        .custom-radio:checked + div {
            border-color: #1E40AF; /* 濃紺 */
            background-color: #EFF6FF; /* 薄い青 */
            position: relative;
        }
        .custom-radio:checked + div::after {
            content: '\f00c'; /* FontAwesome Check */
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            position: absolute;
            top: 10px;
            right: 10px;
            color: #1E40AF;
        }

        .section-title {
            border-left: 4px solid #1E40AF;
            padding-left: 12px;
            font-weight: 700;
            color: #111827;
        }

        /* アニメーション */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* モーダル用スタイル (移植) */
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }
        .modal.show {
            display: flex;
            animation: modalFadeIn 0.3s ease-out;
        }
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body class="pb-24">

    <!-- ヘッダー -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-md mx-auto px-4 py-3 flex items-center justify-between">
            <!-- タイトルをロゴ画像に変更 -->
            <!-- ※ rogo.jpg を同じフォルダに置いてください -->
            <img src="rogo.jpg" alt="戦略整理パートナー" class="h-12 w-auto object-contain" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
            <h1 class="text-lg font-bold text-slate-800 hidden">
                <i class="fa-solid fa-layer-group text-blue-800 mr-2"></i>戦略整理パートナー
            </h1>
            
            <span class="text-xs text-gray-400">Ver 1.1</span>
        </div>
    </header>

    <main class="max-w-md mx-auto px-4 py-6 space-y-8">

        <!-- ① ヒヤリング・チェック画面 -->
        <section class="bg-white p-5 rounded-xl shadow-sm">
            <h2 class="section-title text-lg mb-4">現状の整理</h2>
            <p class="text-sm text-gray-600 mb-4">関わってほしいテーマや、現在の心境に近いものを選んでください。</p>
            
            <div class="space-y-3" id="checklist-container">
                <!-- JSで生成 -->
            </div>
        </section>

        <!-- ② チェック内容の自動整理表示 -->
        <section id="diagnosis-area" class="bg-blue-50 p-5 rounded-xl border border-blue-100 hidden fade-in">
            <h3 class="text-sm font-bold text-blue-800 mb-2"><i class="fa-solid fa-user-doctor mr-2"></i>現在のフェーズ分析</h3>
            <p id="diagnosis-text" class="text-sm leading-relaxed text-slate-700"></p>
        </section>

        <!-- ③ 業務委託コンサル選択画面 -->
        <section class="bg-white p-5 rounded-xl shadow-sm">
            <h2 class="section-title text-lg mb-4">関わり方（プラン選択）</h2>
            <p class="text-sm text-gray-600 mb-4">あなたのペースに合わせた伴走スタイルをお選びください。</p>

            <div class="space-y-4">
                <!-- プランA -->
                <label class="block cursor-pointer relative">
                    <input type="radio" name="plan" value="planA" class="custom-radio sr-only" onchange="updateTotal()">
                    <div class="border-2 border-gray-200 rounded-lg p-4 transition-all hover:border-blue-300">
                        <div class="flex justify-between items-center mb-1">
                            <span class="font-bold text-lg text-slate-800">A 伴走プラン</span>
                            <span class="text-blue-800 font-bold">140,000円<span class="text-xs text-gray-500">/月</span></span>
                        </div>
                        <div class="text-xs text-gray-500 mb-2">週1回 MTG / 思考整理・優先順位設計</div>
                        <p class="text-xs text-slate-600 bg-gray-50 p-2 rounded">
                            判断の壁打ち相手として、週次で方向性を言語化します。スピード感重視の方へ。
                        </p>
                    </div>
                </label>

                <!-- プランB -->
                <label class="block cursor-pointer relative">
                    <input type="radio" name="plan" value="planB" class="custom-radio sr-only" onchange="updateTotal()">
                    <div class="border-2 border-gray-200 rounded-lg p-4 transition-all hover:border-blue-300">
                        <div class="flex justify-between items-center mb-1">
                            <span class="font-bold text-lg text-slate-800">B 設計プラン</span>
                            <span class="text-blue-800 font-bold">80,000円<span class="text-xs text-gray-500">/月</span></span>
                        </div>
                        <div class="text-xs text-gray-500 mb-2">月2回 MTG / 施策レビュー・設計</div>
                        <p class="text-xs text-slate-600 bg-gray-50 p-2 rounded">
                            月次の方向確認と、次の一手の設計を行います。着実に進めたい方へ。
                        </p>
                    </div>
                </label>

                <!-- プランC -->
                <label class="block cursor-pointer relative">
                    <input type="radio" name="plan" value="planC" class="custom-radio sr-only" onchange="updateTotal()">
                    <div class="border-2 border-gray-200 rounded-lg p-4 transition-all hover:border-blue-300">
                        <div class="flex justify-between items-center mb-1">
                            <span class="font-bold text-lg text-slate-800">C 確認プラン</span>
                            <span class="text-blue-800 font-bold">45,000円<span class="text-xs text-gray-500">/月</span></span>
                        </div>
                        <div class="text-xs text-gray-500 mb-2">月1回 MTG / 状況整理・定点観測</div>
                        <p class="text-xs text-slate-600 bg-gray-50 p-2 rounded">
                            判断の迷いをなくすための定点観測を行います。自走できる方のペースメーカーに。
                        </p>
                    </div>
                </label>
            </div>

            <!-- オプション -->
            <div class="mt-6 pt-4 border-t border-gray-100">
                <h4 class="text-sm font-bold text-gray-700 mb-3">対面オプション</h4>
                <div class="space-y-2">
                    <label class="flex items-center space-x-3 p-2 rounded hover:bg-gray-50 cursor-pointer">
                        <input type="checkbox" id="opt-real-monthly" value="20000" class="w-5 h-5 text-blue-800 rounded focus:ring-blue-800 border-gray-300" onchange="updateTotal()">
                        <span class="text-sm text-slate-700">リアル対応（月1回訪問） <span class="text-xs text-gray-500">+20,000円</span></span>
                    </label>
                    <label class="flex items-center space-x-3 p-2 rounded hover:bg-gray-50 cursor-pointer">
                        <input type="checkbox" id="opt-real-once" value="15000" class="w-5 h-5 text-blue-800 rounded focus:ring-blue-800 border-gray-300" onchange="updateTotal()">
                        <span class="text-sm text-slate-700">リアル都度（1回ごと） <span class="text-xs text-gray-500">+15,000円</span></span>
                    </label>
                </div>
            </div>
        </section>

        <!-- ④ 実行サポート（チェック式） -->
        <section class="bg-white p-5 rounded-xl shadow-sm">
            <h2 class="section-title text-lg mb-4">実行サポート</h2>
            <p class="text-sm text-gray-600 mb-4">必要に応じて、具体的な施策もサポート可能です。</p>
            
            <div class="grid grid-cols-1 gap-3" id="support-container">
                <!-- JSで生成 -->
            </div>
        </section>

        <!-- ⑤ 見積自動生成エリア -->
        <section class="bg-slate-800 text-white p-6 rounded-xl shadow-lg">
            <div class="flex justify-between items-end mb-4">
                <span class="text-sm text-slate-300">月額概算費用（税抜）</span>
                <div class="text-3xl font-bold" id="total-price">0<span class="text-base font-normal ml-1">円</span></div>
            </div>
            <div class="bg-slate-700 rounded p-3 text-xs text-slate-300 font-mono" id="price-breakdown-preview">
                プランを選択してください
            </div>
        </section>

        <!-- ⑥ 出力エリア -->
        <section class="space-y-4">
            <h2 class="section-title text-lg">共有・保存用データの生成</h2>
            
            <!-- タブ切り替え風UI -->
            <div class="grid grid-cols-2 gap-2 text-sm font-medium mb-2">
                <button onclick="showOutput('email')" class="bg-white p-3 rounded-lg shadow-sm text-center active:bg-blue-50 focus:ring-2 ring-blue-500">
                    <i class="fa-regular fa-envelope block mb-1 text-xl text-blue-800"></i>
                    メール下書き
                </button>
                <button onclick="showOutput('notebook')" class="bg-white p-3 rounded-lg shadow-sm text-center active:bg-blue-50 focus:ring-2 ring-blue-500">
                    <i class="fa-solid fa-wand-magic-sparkles block mb-1 text-xl text-purple-600"></i>
                    整理データ
                </button>
            </div>

            <!-- メール出力 -->
            <div id="output-email" class="bg-white p-4 rounded-xl shadow-sm hidden">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="font-bold text-sm">見積・提案メール文</h3>
                    <div class="flex space-x-2">
                        <!-- メール作成ボタン: onclickイベントでモーダル起動 -->
                        <button onclick="openMailModal()" class="text-xs bg-slate-600 text-white px-3 py-1 rounded-full hover:bg-slate-700 flex items-center">
                            <i class="fa-solid fa-paper-plane mr-1"></i>メール作成
                        </button>
                        <button onclick="copyToClipboard('email-text')" class="text-xs bg-blue-100 text-blue-800 px-3 py-1 rounded-full hover:bg-blue-200">
                            <i class="fa-regular fa-copy mr-1"></i>コピー
                        </button>
                    </div>
                </div>
                <textarea id="email-text" class="w-full h-48 p-3 text-sm border border-gray-200 rounded bg-gray-50 focus:outline-none focus:border-blue-500" readonly></textarea>
                <p class="text-xs text-gray-400 mt-1 text-right">宛先: spc@smileplusctg.com</p>
            </div>

            <!-- NotebookLM出力 -->
            <div id="output-notebook" class="space-y-4 hidden">
                <!-- ソース -->
                <div class="bg-white p-4 rounded-xl shadow-sm border-l-4 border-purple-500">
                    <div class="flex justify-between items-center mb-2">
                        <div>
                            <h3 class="font-bold text-sm">現状整理ソース</h3>
                            <span class="text-xs text-gray-500">※NotebookLMの「ソース」に貼り付け</span>
                        </div>
                        <button onclick="copyToClipboard('notebook-source')" class="text-xs bg-purple-100 text-purple-800 px-3 py-1 rounded-full hover:bg-purple-200">
                            <i class="fa-regular fa-copy mr-1"></i>コピー
                        </button>
                    </div>
                    <textarea id="notebook-source" class="w-full h-32 p-3 text-xs border border-gray-200 rounded bg-gray-50 font-mono focus:outline-none" readonly></textarea>
                </div>

                <!-- プロンプト -->
                <div class="bg-white p-4 rounded-xl shadow-sm border-l-4 border-green-500">
                    <div class="flex justify-between items-center mb-2">
                        <div>
                            <h3 class="font-bold text-sm">資料作成指示（プロンプト）</h3>
                            <span class="text-xs text-gray-500">※チャット欄に入力</span>
                        </div>
                        <button onclick="copyToClipboard('notebook-prompt')" class="text-xs bg-green-100 text-green-800 px-3 py-1 rounded-full hover:bg-green-200">
                            <i class="fa-regular fa-copy mr-1"></i>コピー
                        </button>
                    </div>
                    <textarea id="notebook-prompt" class="w-full h-24 p-3 text-xs border border-gray-200 rounded bg-gray-50 font-mono focus:outline-none" readonly></textarea>
                </div>
            </div>
        </section>

        <div class="h-10"></div>
    </main>

    <!-- Modal for Send Options (移植・デザイン調整) -->
    <div id="sendOptionsModal" class="modal">
        <div class="bg-white p-6 rounded-2xl max-w-sm w-full mx-4 shadow-2xl relative">
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                <i class="fa-solid fa-xmark text-xl"></i>
            </button>
            
            <h3 class="text-lg font-bold mb-6 text-center text-slate-800">送信方法を選んでください</h3>
            
            <div class="space-y-3">
                <!-- Option 1: Default Mailer -->
                <button onclick="sendViaDefault()" class="w-full flex items-center p-4 border-2 border-slate-100 hover:border-blue-500 hover:bg-blue-50 rounded-xl transition-all group text-left">
                    <div class="w-10 h-10 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center flex-shrink-0 mr-4 group-hover:bg-blue-600 group-hover:text-white transition-colors">
                        <i class="fa-solid fa-envelope text-lg"></i>
                    </div>
                    <div>
                        <p class="font-bold text-slate-800 text-sm">メールソフトで送る</p>
                        <p class="text-xs text-slate-500">標準メーラー、Outlookなど</p>
                    </div>
                </button>

                <!-- Option 2: Gmail -->
                <button onclick="sendViaGmail()" class="w-full flex items-center p-4 border-2 border-slate-100 hover:border-red-500 hover:bg-red-50 rounded-xl transition-all group text-left">
                    <div class="w-10 h-10 bg-red-100 text-red-600 rounded-full flex items-center justify-center flex-shrink-0 mr-4 group-hover:bg-red-600 group-hover:text-white transition-colors">
                        <i class="fa-brands fa-google text-lg"></i>
                    </div>
                    <div>
                        <p class="font-bold text-slate-800 text-sm">Gmailで送る</p>
                        <p class="text-xs text-slate-500">ブラウザでGmailをお使いの方</p>
                    </div>
                </button>

                <!-- Option 3: Copy -->
                <button onclick="copyToClipboard('email-text'); closeModal();" class="w-full flex items-center p-4 border-2 border-slate-100 hover:border-slate-500 hover:bg-slate-50 rounded-xl transition-all group text-left">
                    <div class="w-10 h-10 bg-slate-100 text-slate-600 rounded-full flex items-center justify-center flex-shrink-0 mr-4 group-hover:bg-slate-600 group-hover:text-white transition-colors">
                        <i class="fa-regular fa-copy text-lg"></i>
                    </div>
                    <div>
                        <p class="font-bold text-slate-800 text-sm">コピーする</p>
                        <p class="text-xs text-slate-500">本文をコピーして自分で送る</p>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- 通知トースト -->
    <div id="toast" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-full shadow-lg text-sm opacity-0 transition-opacity pointer-events-none z-[200]">
        コピーしました
    </div>

<script>
    // データ定義
    const checkItems = [
        { id: 'c1', text: '業務の流れを整理したい' },
        { id: 'c2', text: 'WebやSNSの役割を見直したい' },
        { id: 'c3', text: '集客や発信の優先順位を決めたい' },
        { id: 'c4', text: '提案や見積の作り方を改善したい' },
        { id: 'c5', text: '社長の頭の中を整理したい' },
        { id: 'c6', text: '仕組みで回る形を作りたい' }
    ];

    const supportItems = [
        { id: 's1', text: 'Web改善サポート（導線・言葉・構成整理）' },
        { id: 's2', text: 'LP改善支援（構成・文章整理）' },
        { id: 's3', text: 'SNS活用支援（投稿設計・ネタ整理）' },
        { id: 's4', text: '動画活用支援' },
        { id: 's5', text: '業務改善ツール／専用シート作成' }
    ];

    const plans = {
        'planA': { name: 'A 伴走プラン（週1回）', price: 140000, desc: '週1回のMTGで思考整理と優先順位設計を行います。' },
        'planB': { name: 'B 設計プラン（月2回）', price: 80000, desc: '月2回のMTGで施策レビューと次の一手を設計します。' },
        'planC': { name: 'C 確認プラン（月1回）', price: 45000, desc: '月1回のMTGで状況整理と定点観測を行います。' }
    };

    // 初期化処理
    window.onload = () => {
        renderChecklist();
        renderSupport();
    };

    // UIレンダリング
    function renderChecklist() {
        const container = document.getElementById('checklist-container');
        checkItems.forEach(item => {
            const div = document.createElement('div');
            div.innerHTML = `
                <label class="flex items-start space-x-3 p-3 rounded-lg border border-gray-200 bg-white hover:bg-gray-50 cursor-pointer transition-colors">
                    <input type="checkbox" name="needs" value="${item.text}" class="mt-1 w-5 h-5 text-blue-800 rounded focus:ring-blue-800 border-gray-300" onchange="updateDiagnosis(); generateTexts();">
                    <span class="text-sm font-medium text-slate-700">${item.text}</span>
                </label>
            `;
            container.appendChild(div);
        });
    }

    function renderSupport() {
        const container = document.getElementById('support-container');
        supportItems.forEach(item => {
            const div = document.createElement('div');
            div.innerHTML = `
                <label class="flex items-center space-x-3 p-3 rounded-lg border border-dashed border-gray-300 bg-gray-50 hover:bg-white hover:border-blue-300 cursor-pointer transition-colors">
                    <input type="checkbox" name="support" value="${item.text}" class="w-4 h-4 text-blue-600 rounded focus:ring-blue-600 border-gray-300" onchange="updateTotal()">
                    <span class="text-xs font-medium text-slate-600">${item.text}</span>
                </label>
            `;
            container.appendChild(div);
        });
    }

    // ② 診断ロジック
    function updateDiagnosis() {
        const checkedCount = document.querySelectorAll('input[name="needs"]:checked').length;
        const area = document.getElementById('diagnosis-area');
        const text = document.getElementById('diagnosis-text');

        if (checkedCount === 0) {
            area.classList.add('hidden');
            return;
        }

        area.classList.remove('hidden');
        
        let msg = "";
        if (checkedCount >= 4) {
            msg = "多くの課題を感じておられるようですが、今は「拡大」よりも「足元の地固め」を優先すべき時期かもしれません。まずは思考の断捨離を行い、本当に注力すべき1点を見つけることから始めましょう。";
        } else if (checkedCount >= 1) {
            msg = "やるべきことは見えているものの、具体的な進め方や優先順位の判断で迷いが生じている状態とお見受けします。第三者の視点を入れて、客観的な整理を行うことで、動き出しがスムーズになるはずです。";
        }
        text.innerText = msg;
    }

    // ⑤ 合計計算 & テキスト生成トリガー
    function updateTotal() {
        const planEl = document.querySelector('input[name="plan"]:checked');
        let total = 0;
        let breakdown = [];

        // プラン計算
        if (planEl) {
            const plan = plans[planEl.value];
            total += plan.price;
            breakdown.push(`■基本: ${plan.name} ... ¥${plan.price.toLocaleString()}`);
        }

        // オプション計算
        const realMonthly = document.getElementById('opt-real-monthly');
        const realOnce = document.getElementById('opt-real-once');
        
        if (realMonthly.checked) {
            total += parseInt(realMonthly.value);
            breakdown.push(`・オプション: リアル対応（月1回） ... +¥${parseInt(realMonthly.value).toLocaleString()}`);
        }
        if (realOnce.checked) {
            total += parseInt(realOnce.value);
            breakdown.push(`・オプション: リアル都度 ... +¥${parseInt(realOnce.value).toLocaleString()}`);
        }

        // サポート計算
        const supports = document.querySelectorAll('input[name="support"]:checked');
        if (supports.length > 0) {
            breakdown.push("-------------------");
            breakdown.push("■実行サポート（詳細別途）:");
            supports.forEach(s => breakdown.push(`・${s.value}`));
        }

        document.getElementById('total-price').innerText = total.toLocaleString();
        document.getElementById('price-breakdown-preview').innerHTML = breakdown.length > 0 ? breakdown.join('<br>') : 'プランを選択してください';

        generateTexts(breakdown, total);
    }

    // ⑥ テキスト生成ロジック
    function generateTexts(breakdownArr = [], totalPrice = 0) {
        const planEl = document.querySelector('input[name="plan"]:checked');
        const needs = Array.from(document.querySelectorAll('input[name="needs"]:checked')).map(e => e.value);
        const supports = Array.from(document.querySelectorAll('input[name="support"]:checked')).map(e => e.value);
        
        if (!planEl) return;

        const planData = plans[planEl.value];

        // A. メール文
        const emailSubject = "【お見積り】業務委託コンサルティングのご提案について";
        const emailBody = `
件名：${emailSubject}

いつも大変お世話になっております。
先ほどはお時間をいただき、ありがとうございました。

本日お伺いした内容をもとに、
貴社の現状に合わせた最適なプランを整理いたしました。

まずは「${planData.name.split('（')[0]}」にて、
現状の課題整理と優先順位の明確化からご一緒できればと考えております。

--------------------------------------------------
【ご提案内容】
${planData.name}

■月額費用
${totalPrice.toLocaleString()}円（税抜）

■内訳
${breakdownArr.join('\n').replace(/<br>/g, '\n')}

■サポート内容
・${planData.desc}
${supports.length > 0 ? '・その他、実行サポートとして以下も連携可能です。\n  ' + supports.join(' / ') : ''}
--------------------------------------------------

まずは小さく始めて、状況を見ながら柔軟に形を変えていくことも可能です。
ご検討のほど、よろしくお願いいたします。
        `.trim();
        document.getElementById('email-text').value = emailBody;

        // C. NotebookLM ソース
        const notebookSource = `
【クライアント現状整理シート】

■関心テーマ・課題感
${needs.map(n => `・${n}`).join('\n')}

■現在のフェーズ仮説
${document.getElementById('diagnosis-text').innerText}

■提案プラン
${planData.name}
（${planData.desc}）

■実行サポート候補
${supports.length > 0 ? supports.map(s => `・${s}`).join('\n') : 'なし'}
        `.trim();
        document.getElementById('notebook-source').value = notebookSource;

        // D. NotebookLM プロンプト
        const notebookPrompt = `
上記のソース情報を元に、以下の資料を作成してください。

1. 【現状の課題と方向性】を整理したインフォグラフィックの構成案
   - 課題を「原因」と「現象」に構造化してください。
   - 解決の方向性を3つのステップで示してください。

2. 【提案プランのロードマップ】のスライド構成案
   - 最初の3ヶ月で何に取り組み、どういう状態を目指すかを月ごとに箇条書きしてください。
   - クライアントへの「寄り添い」と「安心感」が伝わる言葉を選んでください。
        `.trim();
        document.getElementById('notebook-prompt').value = notebookPrompt;
    }

    // ==========================================
    // 新規追加: メーラー選択モーダル関連
    // ==========================================
    
    // モーダルを開く
    function openMailModal() {
        const planEl = document.querySelector('input[name="plan"]:checked');
        
        // プラン未選択時のガード
        if (!planEl) {
            alert("まずはプランを選択してください。");
            return;
        }

        document.getElementById('sendOptionsModal').classList.add('show');
    }

    // モーダルを閉じる
    function closeModal() {
        document.getElementById('sendOptionsModal').classList.remove('show');
    }

    // 共通：メールデータの取得
    function getEmailData() {
        const toAddress = "spc@smileplusctg.com";
        const emailBody = document.getElementById('email-text').value;
        
        // 件名を抽出
        let emailSubject = "【お見積り】業務委託コンサルティングのご提案について";
        const firstLine = emailBody.split('\n')[0];
        if (firstLine && firstLine.includes('件名：')) {
            emailSubject = firstLine.replace('件名：', '').trim();
        }

        return { to: toAddress, subject: emailSubject, body: emailBody };
    }

    // 1. 標準メーラーで送信
    function sendViaDefault() {
        const data = getEmailData();
        const mailtoUrl = `mailto:${data.to}?subject=${encodeURIComponent(data.subject)}&body=${encodeURIComponent(data.body)}`;
        window.location.href = mailtoUrl;
        closeModal();
    }

    // 2. Gmailで送信
    function sendViaGmail() {
        const data = getEmailData();
        // Gmail作成画面のURL
        const gmailUrl = `https://mail.google.com/mail/?view=cm&fs=1&to=${data.to}&su=${encodeURIComponent(data.subject)}&body=${encodeURIComponent(data.body)}`;
        window.open(gmailUrl, '_blank');
        closeModal();
    }

    // ユーティリティ
    function showOutput(type) {
        document.getElementById('output-email').classList.add('hidden');
        document.getElementById('output-notebook').classList.add('hidden');
        
        if (type === 'email') {
            document.getElementById('output-email').classList.remove('hidden');
        } else {
            document.getElementById('output-notebook').classList.remove('hidden');
        }
    }

    function copyToClipboard(elementId) {
        const copyText = document.getElementById(elementId);
        if (!copyText.value) return;

        copyText.select();
        copyText.setSelectionRange(0, 99999);
        document.execCommand("copy");

        const toast = document.getElementById('toast');
        toast.classList.remove('opacity-0');
        setTimeout(() => {
            toast.classList.add('opacity-0');
        }, 2000);
    }
</script>
</body>
</html>